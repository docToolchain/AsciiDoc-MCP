#!/usr/bin/env bash

# dtcw - Simple docToolchain wrapper for basic documentation generation
# This is a simplified version that uses asciidoctor directly

set -e

# Default command
COMMAND=${1:-help}

# Function to check if asciidoctor is installed
check_asciidoctor() {
    if ! command -v asciidoctor >/dev/null 2>&1; then
        echo "Installing asciidoctor..."
        if command -v gem >/dev/null 2>&1; then
            gem install asciidoctor asciidoctor-pdf
        else
            echo "Error: Ruby and gem are required to install asciidoctor"
            echo "Please install Ruby and gem, then run: gem install asciidoctor asciidoctor-pdf"
            exit 1
        fi
    fi
}

# Function to generate HTML
generate_html() {
    check_asciidoctor
    echo "Generating HTML documentation..."
    mkdir -p build/docs/html5
    
    asciidoctor \
        -D build/docs/html5 \
        -a toc=left \
        -a toclevels=3 \
        -a sectanchors \
        -a sectlinks \
        -a source-highlighter=highlightjs \
        src/docs/arc42/arc42-template.adoc
    
    echo "HTML documentation generated in build/docs/html5/"
}

# Function to generate PDF
generate_pdf() {
    check_asciidoctor
    echo "Generating PDF documentation..."
    mkdir -p build/docs/pdf
    
    asciidoctor-pdf \
        -D build/docs/pdf \
        -a pdf-theme=default \
        src/docs/arc42/arc42-template.adoc
    
    echo "PDF documentation generated in build/docs/pdf/"
}

# Function to show help
show_help() {
    echo "dtcw - Simple docToolchain wrapper"
    echo ""
    echo "Usage: ./dtcw [COMMAND]"
    echo ""
    echo "Commands:"
    echo "  generateHTML      Generate HTML documentation"
    echo "  generatePDF       Generate PDF documentation"  
    echo "  generateMicrosite Generate microsite (alias for generateHTML)"
    echo "  help              Show this help"
    echo ""
    echo "Generated files will be placed in the build/docs/ directory"
}

# Main command handling
case "$COMMAND" in
    generateHTML)
        generate_html
        ;;
    generatePDF)
        generate_pdf
        ;;
    generateMicrosite)
        generate_html
        ;;
    help|--help|-h)
        show_help
        ;;
    *)
        echo "Unknown command: $COMMAND"
        show_help
        exit 1
        ;;
esac